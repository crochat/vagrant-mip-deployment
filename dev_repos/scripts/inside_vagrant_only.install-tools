#!/usr/bin/env bash

DOCKER_DOWNLOAD_HOST="download.docker.com"
REQUIRED_OS_DISTRIBUTOR_ID="Ubuntu"
REQUIRED_OS_RELEASE="20.04"
REQUIRED_DOCKER_VERSION="20.10.0"

PREREQUIRED_PACKAGES="git apt-transport-https ca-certificates ssl-cert curl gnupg-agent software-properties-common net-tools whois lsof expect python3-pip"
REQUIRED_PACKAGES="docker-ce docker-ce-cli docker-ce-rootless-extras containerd.io"
REQUIRED_PIP3_PACKAGES="chardet"
REQUIRED_CUSTOM_PACKAGES="docker-compose"

SCRIPTS_PATH=""

positional=()
while [[ $# -gt 0 ]]; do
	case $1 in
		--scripts-path)
			if [[ "$2" != "" && "$(echo "$2" | cut -c1)" != "-" ]]; then
				SCRIPTS_PATH="$2"
				shift
			fi
			shift
			;;
		*)
			positional+=("$1")
			shift
			;;
	esac
done

if [[ ! -f $SCRIPTS_PATH/utils ]]; then
	echo "ERROR: $SCRIPTS_PATH/utils: file not found!" >/dev/stderr
	exit 1
fi
source $SCRIPTS_PATH/utils


ret=1

check_os
ret=$?
if [[ $ret -eq 0 ]]; then
	install_required_packages prerequired
	ret=$?
fi

if [[ $ret -eq 0 ]]; then
	prepare_docker_apt_sources
	ret=$?
fi

if [[ $ret -eq 0 ]]; then
	install_required_packages required
	ret=$?
fi

if [[ $ret -eq 0 ]]; then
	install_required_packages pip3
	ret=$?
fi

if [[ $ret -eq 0 ]]; then
	install_required_custom_packages
	ret=$?
fi

exit $ret
